<!-- Mobile Header -->
<header class="mobile-header">
    <h2 id="mobile-name">Learner</h2>
    <button class="logout-btn-mini" onclick="handleLogout()">Logout</button>
</header>

<div class="dashboard-wrapper">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2 id="sidebar-name">Learner</h2>
            <button class="primary-btn" id="sidebar-history-btn"
                style="padding: 5px 10px; font-size: 0.65rem; margin-top: 10px; background: rgba(255,255,255,0.05); width: 100%;">
                âŒ› View Chat History
            </button>
        </div>

        <div class="sidebar-subjects-header">
            <h4 class="form-group label" style="margin: 0;">ENROLLED SUBJECTS</h4>
            <button class="add-subj-btn-mini" onclick="toggleSubjectPopup()" title="Add Subject">+</button>
        </div>
        <div class="sidebar-subjects">
            <ul id="my-subjects-list" style="padding:0; margin:0;"></ul>
        </div>

        <!-- Sidebar Popup for Add Subject (Desktop) -->
        <div id="sidebar-subject-popup" class="sidebar-popup">
            <h4>Enroll in Subject</h4>
            <p style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 10px;">Curriculum: <strong
                    id="popup-curriculum" style="color: var(--text-main);"></strong></p>
            <select id="popup-subj-select" style="margin: 0;"></select>
            <div class="popup-actions">
                <button class="primary-btn" id="popup-enroll-btn">Enroll</button>
                <button class="logout-btn" onclick="toggleSubjectPopup()" style="margin:0;">Cancel</button>
            </div>
        </div>

        <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </aside>

    <main class="main-dashboard">
        <!-- Dashboard Content Grid -->
        <div class="top-row">
            <!-- Profile Card -->
            <div class="profile-card-new">
                <div class="profile-img-container" onclick="triggerProfilePictureUpload()">
                    <img id="profile-img" src="" alt="Profile" style="display: none;">
                    <div id="profile-initials" class="profile-initials">?</div>
                    <div class="profile-img-overlay">ðŸ“·</div>
                    <input type="file" id="profile-img-input" accept="image/*" style="display: none;"
                        onchange="handleProfilePictureChange(event)">
                </div>
                <div class="profile-info">
                    <h1 id="prof-full-name">Name Surname</h1>
                    <p id="prof-curriculum">Curriculum</p>
                    <p id="prof-grade">Grade</p>
                    <p class="profile-quote">"The future belongs in those who believe in the beauty of their dreams."
                    </p>
                </div>
            </div>

            <!-- Dashboard Control Quick Cards -->
            <div class="sub-cards-grid" id="critical-cards-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Subject enrollment is now handled via popups -->

        <!-- Conditional Profile Setup Form -->
        <div id="profile-setup-card" style="display: none; margin-bottom: 30px;" class="stats-card">
            <h3 style="margin-bottom: 25px;">Complete Your Profile</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" id="p-name" placeholder="Enter first name">
                </div>
                <div class="form-group">
                    <label>Surname</label>
                    <input type="text" id="p-surname" placeholder="Enter surname">
                </div>
                <div class="form-group">
                    <label>Grade</label>
                    <select id="p-grade" onchange="loadSubjects()">
                        <option value="">Loading grades...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Curriculum</label>
                    <select id="p-curriculum">
                        <option value="CAPS">CAPS</option>
                        <option value="IEB">IEB</option>
                        <option value="Cambridge">Cambridge</option>
                    </select>
                </div>
            </div>
            <button class="primary-btn" id="save-profile-btn" style="width: 100%; margin-top: 20px;">Save Profile
                Information</button>
        </div>

        <!-- Visual Stats Grid -->
        <div class="bottom-grid">
            <div class="stats-card">
                <h3>Weekly Progress</h3>
                <div class="chart-bars">
                    <div class="bar" style="height: 40%;"></div>
                    <div class="bar" style="height: 70%;"></div>
                    <div class="bar" style="height: 55%;"></div>
                    <div class="bar" style="height: 90%;"></div>
                    <div class="bar" style="height: 60%;"></div>
                    <div class="bar" style="height: 80%;"></div>
                    <div class="bar" style="height: 65%;"></div>
                </div>
                <div
                    style="display:flex; justify-content: space-around; font-size: 0.8rem; margin-top: 20px; color: var(--text-dim);">
                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                </div>
            </div>
            <div class="stats-card">
                <h3>Study Schedule</h3>
                <div
                    style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; height: 160px; padding-top: 10px;">
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--text-main); border: 1px solid var(--border-main);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                    <div style="background: var(--bg-pure); border: 1px solid var(--border-subtle);"></div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Mobile Footer -->
<footer class="mobile-footer">
    <button class="add-subj-btn-mini" onclick="toggleSubjectPopup()">+</button>
    <div class="mobile-subjects-bar">
        <ul id="mobile-subjects-list"></ul>
    </div>
</footer>

<!-- Footer Popup for Add Subject (Mobile) -->
<div id="footer-subject-popup" class="footer-popup">
    <h4>Enroll in a New Subject</h4>
    <p style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 10px;">Curriculum: <strong
            id="footer-popup-curriculum" style="color: var(--text-main);"></strong></p>
    <select id="footer-subj-select" style="margin: 0;"></select>
    <div class="popup-actions">
        <button class="primary-btn" id="footer-enroll-btn">Enroll</button>
        <button class="logout-btn" onclick="toggleSubjectPopup()" style="margin:0;">Cancel</button>
    </div>
</div>